<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ˜Ÿé—¨å›½å®¶é‚®ä»¶ç³»ç»Ÿ | SCMS</title>
<style>
body{
  font-family:"Microsoft YaHei",sans-serif;
  background:#0b0c2a;
  color:#fff;
  margin:0;
  padding:0;
  text-align:center;
}
header{
  padding:20px;
  background:rgba(255,255,255,.05);
}
section{
  width:90%;
  max-width:600px;
  margin:20px auto;
  padding:15px;
  background:rgba(255,255,255,.08);
  border-radius:10px;
}
input,textarea,button{
  width:80%;
  padding:8px;
  margin:5px 0;
  border-radius:5px;
  border:none;
}
textarea{
  height:100px;
  background:#111;
  color:#fff;
}
button{
  background:#f0c000;
  color:#000;
  cursor:pointer;
  transition:.2s;
}
button:hover{background:#ffd700;}
.mail-item{
  padding:5px;
  border-bottom:1px solid #333;
  cursor:pointer;
}
.mail-item:hover{background:#222;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
  <h1>æ˜Ÿé—¨å›½å®¶é‚®ä»¶ç³»ç»Ÿ</h1>
  <h3>StarGate Civilization Mail System (SCMS)</h3>
</header>

<!-- ç™»å½•/æ³¨å†Œ -->
<section id="auth-section">
  <h3>ç™»å½• / æ³¨å†Œè´¦æˆ·</h3>
  <input id="username" placeholder="ç”¨æˆ·å / Username"><br>
  <input id="password" type="password" placeholder="å¯†ç  / Password"><br>
  <button onclick="register()">æ³¨å†Œ / Register</button>
  <button onclick="login()">ç™»å½• / Login</button>
  <p id="auth-msg"></p>
</section>

<!-- ä¸»èœå• -->
<section id="main-menu" class="hidden">
  <h3>æ¬¢è¿å›æ¥ï¼Œ<span id="user-name"></span></h3>
  <button onclick="gotoPage('inbox')">ğŸ“¥ æ”¶ä»¶ç®± Inbox</button>
  <button onclick="gotoPage('sent')">ğŸ“¤ å‘ä»¶ç®± Sent</button>
  <button onclick="gotoPage('compose')">âœ‰ï¸ å†™ä¿¡ Compose</button>
  <button onclick="logout()">é€€å‡º Logout</button>
</section>

<!-- æ”¶ä»¶ç®± -->
<section id="inbox-section" class="hidden">
  <h3>ğŸ“¥ æ”¶ä»¶ç®± Inbox</h3>
  <div id="inbox-list"></div>
  <textarea id="inbox-content" readonly placeholder="é‚®ä»¶å†…å®¹ / Mail Content"></textarea>
</section>

<!-- å‘ä»¶ç®± -->
<section id="sent-section" class="hidden">
  <h3>ğŸ“¤ å‘ä»¶ç®± Sent</h3>
  <div id="sent-list"></div>
  <textarea id="sent-content" readonly placeholder="é‚®ä»¶å†…å®¹ / Mail Content"></textarea>
</section>

<!-- å†™ä¿¡ -->
<section id="compose-section" class="hidden">
  <h3>âœ‰ï¸ æ’°å†™é‚®ä»¶ Compose</h3>
  <input id="to" placeholder="æ”¶ä»¶äºº / To"><br>
  <input id="subject" placeholder="ä¸»é¢˜ / Subject"><br>
  <textarea id="content" placeholder="æ­£æ–‡ / Message"></textarea><br>
  <button onclick="sendMail()">å‘é€ / Send</button>
  <p id="send-msg"></p>
</section>

<script>
/* ========== æ•°æ®å±‚ ========== */
const getUsers = () => JSON.parse(localStorage.getItem("SCMS-users") || "{}");
const setUsers = u => localStorage.setItem("SCMS-users", JSON.stringify(u));

/* ========== æ³¨å†Œ ========== */
function register(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!username || !password) return msg("auth-msg", "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º");
  const users = getUsers();
  if(users[username]) return msg("auth-msg", "ç”¨æˆ·å·²å­˜åœ¨");
  users[username] = {password, inbox:[], sent:[]};
  setUsers(users);
  msg("auth-msg", "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•");
}

/* ========== ç™»å½• ========== */
function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const users = getUsers();
  if(users[username] && users[username].password === password){
    localStorage.setItem("SCMS-currentUser", username);
    showMainMenu(username);
    gotoPage("main-menu");
  } else msg("auth-msg", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
}

/* ========== ç™»å‡º ========== */
function logout(){
  localStorage.removeItem("SCMS-currentUser");
  localStorage.removeItem("SCMS-currentPage");
  location.reload();
}

/* ========== é¡µé¢åˆ‡æ¢ ========== */
function gotoPage(page){
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(page + "-section").classList.remove("hidden");
  localStorage.setItem("SCMS-currentPage", page);
  if(page === "inbox") showInbox();
  if(page === "sent") showSent();
  if(page === "compose") msg("send-msg", "");
}

/* ========== ä¸»èœå• ========== */
function showMainMenu(username){
  document.getElementById("auth-section").classList.add("hidden");
  document.getElementById("main-menu").classList.remove("hidden");
  document.getElementById("user-name").textContent = username;
}

/* ========== æ”¶ä»¶ç®± ========== */
function showInbox(){
  const u = localStorage.getItem("SCMS-currentUser");
  const mails = getUsers()[u]?.inbox || [];
  const list = document.getElementById("inbox-list");
  list.innerHTML = mails.length ? "" : "æš‚æ— é‚®ä»¶";
  mails.forEach(m => {
    const div = document.createElement("div");
    div.className = "mail-item";
    div.textContent = `æ¥è‡ª ${m.from}ï¼š${m.subject}`;
    div.onclick = () => document.getElementById("inbox-content").value = m.content;
    list.appendChild(div);
  });
}

/* ========== å‘ä»¶ç®± ========== */
function showSent(){
  const u = localStorage.getItem("SCMS-currentUser");
  const mails = getUsers()[u]?.sent || [];
  const list = document.getElementById("sent-list");
  list.innerHTML = mails.length ? "" : "æš‚æ— é‚®ä»¶";
  mails.forEach(m => {
    const div = document.createElement("div");
    div.className = "mail-item";
    div.textContent = `å‘ç»™ ${m.to}ï¼š${m.subject}`;
    div.onclick = () => document.getElementById("sent-content").value = m.content;
    list.appendChild(div);
  });
}

/* ========== å†™ä¿¡ ========== */
function sendMail(){
  const from = localStorage.getItem("SCMS-currentUser");
  const to = document.getElementById("to").value.trim();
  const subject = document.getElementById("subject").value.trim();
  const content = document.getElementById("content").value.trim();
  if(!to || !subject || !content) return msg("send-msg", "è¯·å¡«å†™å®Œæ•´");
  const users = getUsers();
  if(!users[to]) return msg("send-msg", "æ”¶ä»¶äººä¸å­˜åœ¨");
  const mail = {from, to, subject, content};
  users[to].inbox.push(mail);
  users[from].sent.push(mail);
  setUsers(users);
  msg("send-msg", "å‘é€æˆåŠŸ");
  // æ¸…ç©ºè¡¨å•
  document.getElementById("to").value = "";
  document.getElementById("subject").value = "";
  document.getElementById("content").value = "";
  // å¯é€‰ï¼šè‡ªåŠ¨è·³è½¬å‘ä»¶ç®±
  // gotoPage("sent");
}

/* ========== è‡ªåŠ¨ç™»å½• & æ¢å¤é¡µé¢ ========== */
window.onload = () => {
  const user = localStorage.getItem("SCMS-currentUser");
  const page = localStorage.getItem("SCMS-currentPage") || "main-menu";
  if(user){
    showMainMenu(user);
    gotoPage(page);
  }
};

/* ========== å°å·¥å…· ========== */
function msg(id, txt){ document.getElementById(id).textContent = txt; }
</script>
</body>
</html>
