<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>SCMS - ä¸»é¡µ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{--bg:#0b0c2a;--fg:#fff;--card:rgba(255,255,255,.08);--accent:#f0c000;}
    body.light{--bg:#f5f5f5;--fg:#111;--card:rgba(0,0,0,.05);}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Microsoft YaHei;display:flex;flex-direction:column;min-height:100vh;}
    header{height:56px;background:var(--card);display:flex;align-items:center;padding:0 20px;justify-content:space-between;}
    main{display:flex;flex:1;overflow:hidden;}
    aside{width:220px;background:var(--card);padding:10px;display:flex;flex-direction:column;gap:8px;font-size:14px;}
    aside a{text-decoration:none;color:var(--fg);display:flex;justify-content:space-between;padding:8px 12px;border-radius:6px;}
    aside a:hover{background:rgba(255,255,255,.1);}
    aside .badge{background:var(--accent);color:#000;font-size:12px;padding:2px 6px;border-radius:10px;}
    #content{flex:1;padding:20px;overflow-y:auto;}
    textarea,input{width:100%;padding:8px;margin:4px 0;border:none;border-radius:4px;}
    button{padding:6px 12px;margin:4px 2px;border:none;border-radius:4px;background:var(--accent);color:#000;cursor:pointer;}
    button:hover{background:#ffd700;}
    .mail{padding:10px;background:var(--card);border-radius:6px;margin-bottom:8px;cursor:pointer;}
    .mail:hover{background:rgba(255,255,255,.1);}
    footer{padding:15px;text-align:center;font-size:12px;color:#aaa;}
  </style>
</head>
<body>
  <header>
    <span><i class="fa fa-envelope"></i> æ˜Ÿé—¨é‚®ä»¶ç³»ç»Ÿ</span>
    <div>
      <button onclick="toggleTheme()">ğŸŒ“ ä¸»é¢˜</button>
      <button onclick="logout()"><i class="fa fa-sign-out-alt"></i> é€€å‡º</button>
    </div>
  </header>

  <main>
    <aside>
      <a href="#" onclick="showCompose()"><span><i class="fa fa-edit"></i> å†™ä¿¡</span></a>
      <a href="#" onclick="showFolder('inbox')"><span><i class="fa fa-inbox"></i> æ”¶ä»¶ç®±</span><span class="badge" id="inboxBadge">0</span></a>
      <a href="#" onclick="showFolder('sent')"><span><i class="fa fa-paper-plane"></i> å‘ä»¶ç®±</span><span class="badge" id="sentBadge">0</span></a>
      <a href="#" onclick="showFolder('draft')"><span><i class="fa fa-file-alt"></i> è‰ç¨¿</span><span class="badge" id="draftBadge">0</span></a>
      <a href="#" onclick="showFolder('trash')"><span><i class="fa fa-trash"></i> å·²åˆ é™¤</span><span class="badge" id="trashBadge">0</span></a>
    </aside>

    <section id="content">
      <!-- é»˜è®¤æ˜¾ç¤ºå†™ä¿¡ -->
      <div id="composeView">
        <h2>âœ‰ï¸ å†™ä¿¡</h2>
        <input id="to" placeholder="æ”¶ä»¶äººï¼ˆéšæ„ç”¨æˆ·åï¼‰">
        <input id="subject" placeholder="ä¸»é¢˜">
        <textarea id="body" rows="8" placeholder="æ­£æ–‡"></textarea>
        <div>
          <button onclick="sendMail()">å‘é€</button>
          <button onclick="saveDraft()">å­˜è‰ç¨¿</button>
        </div>
      </div>

      <!-- é‚®ä»¶åˆ—è¡¨ -->
      <div id="listView" style="display:none;">
        <h2 id="folderTitle">æ”¶ä»¶ç®±</h2>
        <div id="mailList"></div>
      </div>
    </section>
  </main>

  <footer>Â© 2024 StarGate Civilization Mail System</footer>

  <script>
    /* ===== å·¥å…· ===== */
    const u = localStorage.getItem('SCMS-user');
    if (!u) location.href = 'index.html';

    function toggleTheme() {
      document.body.classList.toggle('light');
    }
    function logout() {
      localStorage.clear();
      location.href = 'index.html';
    }

    /* ===== æ•°æ®å±‚ ===== */
    function getStore() {
      return {
        inbox: JSON.parse(localStorage.getItem('SCMS-inbox') || '[]'),
        sent: JSON.parse(localStorage.getItem('SCMS-sent') || '[]'),
        draft: JSON.parse(localStorage.getItem('SCMS-draft') || '[]'),
        trash: JSON.parse(localStorage.getItem('SCMS-trash') || '[]')
      };
    }
    function setStore(key, arr) {
      localStorage.setItem('SCMS-' + key, JSON.stringify(arr));
    }

    /* ===== ç•Œé¢åˆ‡æ¢ ===== */
    function showCompose() {
      document.getElementById('composeView').style.display = 'block';
      document.getElementById('listView').style.display = 'none';
    }
    function showFolder(f) {
      document.getElementById('composeView').style.display = 'none';
      document.getElementById('listView').style.display = 'block';
      document.getElementById('folderTitle').textContent = {inbox:'æ”¶ä»¶ç®±',sent:'å‘ä»¶ç®±',draft:'è‰ç¨¿',trash:'å·²åˆ é™¤'}[f];
      renderList(f);
      updateBadges();
    }

    /* ===== å†™ä¿¡ ===== */
    function sendMail() {
      const to = document.getElementById('to').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const body = document.getElementById('body').value.trim();
      if (!to || !subject) return alert('æ”¶ä»¶äººå’Œä¸»é¢˜å¿…å¡«');
      const s = getStore();
      const mail = {from:u, to, subject, body, date: new Date().toISOString(), id: crypto.randomUUID()};
      s.sent.push(mail);
      // ä¼ªé€ ä¸€å°â€œæ”¶ä»¶â€ç»™å¯¹æ–¹
      const inbox = JSON.parse(localStorage.getItem('SCMS-inbox-' + to) || '[]');
      inbox.push({...mail, read:false});
      localStorage.setItem('SCMS-inbox-' + to, JSON.stringify(inbox));
      setStore('sent', s.sent);
      alert('å‘é€æˆåŠŸ');
      ['to','subject','body'].forEach(id=>document.getElementById(id).value='');
      updateBadges();
    }
    function saveDraft() {
      const subject = document.getElementById('subject').value.trim();
      const body = document.getElementById('body').value.trim();
      if (!subject && !body) return;
      const s = getStore();
      s.draft.push({subject, body, date:new Date().toISOString(), id:crypto.randomUUID()});
      setStore('draft', s.draft);
      alert('è‰ç¨¿å·²ä¿å­˜');
      updateBadges();
    }

    /* ===== åˆ—è¡¨ ===== */
    function renderList(folder) {
      let src;
      if (folder==='inbox') src = JSON.parse(localStorage.getItem('SCMS-inbox-' + u) || '[]');
      else src = getStore()[folder];
      const list = document.getElementById('mailList');
      if (!src.length) return list.innerHTML = '<p style="color:#aaa;">æš‚æ— é‚®ä»¶</p>';
      list.innerHTML = src.map((m,idx) => `
        <div class="mail" onclick="viewMail('${folder}',${idx})">
          <b>${folder==='inbox'?m.from:m.to}</b> Â· ${m.subject}
          <br><small>${new Date(m.date).toLocaleString()}</small>
        </div>`).join('');
    }
    function viewMail(folder, idx) {
      const src = folder==='inbox'
        ? JSON.parse(localStorage.getItem('SCMS-inbox-' + u) || '[]')
        : getStore()[folder];
      const m = src[idx];
      if (folder==='inbox' && !m.read) { m.read=true; localStorage.setItem('SCMS-inbox-'+u, JSON.stringify(src)); updateBadges();}
      alert(`ä¸»é¢˜ï¼š${m.subject}\n\n${m.body}\n\nâ€”â€” ä»…æµè§ˆï¼Œæ— æ“ä½œ`);
    }

    /* ===== å¾½ç«  ===== */
    function updateBadges() {
      const s = getStore();
      const inbox = JSON.parse(localStorage.getItem('SCMS-inbox-' + u) || '[]');
      document.getElementById('inboxBadge').textContent = inbox.filter(m=>!m.read).length;
      document.getElementById('sentBadge').textContent = s.sent.length;
      document.getElementById('draftBadge').textContent = s.draft.length;
      document.getElementById('trashBadge').textContent = s.trash.length;
    }

    /* ===== åˆå§‹åŒ– ===== */
    updateBadges();
  </script>
</body>
</html>
